<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    <title>云书</title>
    <link rel="stylesheet" href="../source/mui/css/mui.css">
    <link rel="stylesheet" href="../source/css/mui_overwrite.css">
    <link rel="stylesheet" href="../source/css/public.css">
    <link rel="stylesheet" href="../source/css/index.css">
    <script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
    <script src="../source/js/jquery-1.11.1.min.js"></script>
    <script src="../source/mui/js/mui.js"></script>
    <script src="../source/js/ajax.js"></script>
    <script src="../source/js/public.js"></script>
</head>
<body>
    <header id="header" class="mui-bar top mui-bar-transparent">
        <a data-href="./indexPage_searchcitylist.html" class="mui-btn mui-btn-link">
            <span id="currentCityName">获取中</span>
            <span style="font-size: 14px;top: -2px;" class="mui-icon mui-icon-arrowdown"></span>
        </a>
        <h1 class="mui-title">
            <div class="mui-search-right">
                <input id="searchBookInput" type="search" placeholder="搜索您需要的教材">
                <span class="mui-icon mui-icon-search"></span>
            </div>
        </h1>
    </header>
    <nav class="mui-bar mui-bar-tab">
        <a class="mui-tab-item mui-active">
            <span class="mui-icon">
                <img class="normal" src="../source/webslice/0_tabbar/home_tabbar_normal.png" alt="">
                <img class="selection" src="../source/webslice/0_tabbar/home_tabbar_selection.png" alt="">
            </span>
            <span class="mui-tab-label">首页</span>
        </a>
<!--         <a data-href="discoveryPage.html" class="mui-tab-item">
            <span class="mui-icon">
                <img class="normal" src="../source/webslice/0_tabbar/detection_tabbar_normal.png" alt="">
                <img class="selection" src="../source/webslice/0_tabbar/detection_tabbar_selection.png" alt="">
            </span>
            <span class="mui-tab-label">发现</span>
        </a> -->
        <a data-href="cartPage.html" class="mui-tab-item">
            <span class="mui-icon">
                <img class="normal" src="../source/webslice/0_tabbar/cart_tabbar_normal.png" alt="">
                <img class="selection" src="../source/webslice/0_tabbar/cart_tabbar_selection.png" alt="">
            </span>
            <span class="mui-tab-label">购物车</span>
        </a>
        <a data-href="userPage.html" class="mui-tab-item">
            <span class="mui-icon">
                <img class="normal" src="../source/webslice/0_tabbar/me_tabbar_normal.png" alt="">
                <img class="selection" src="../source/webslice/0_tabbar/me_tabbar_selection.png" alt="">
            </span>
            <span class="mui-tab-label">我的</span>
        </a>
    </nav>
	<div class="mui-content">
        <div class="index-bg-header">
            <div id="slider" class="mui-slider" >
                <div class="mui-slider-group mui-slider-loop">
                    
                </div>
                <div class="mui-slider-indicator">
                    <div class="mui-indicator mui-active"></div>
                    <div class="mui-indicator"></div>
                </div>
            </div>
        </div>
        <div style="margin-bottom:10px;background-color: #fff;">
            <nav class="mui-bar-tab user-bar-tab">
                <a data-href="indexPage_panicBuy.html">
                <!-- <a data-href="../cloudbook-h5/panicbuy/index.html?%7B%22device%22:%22wechat%22%7D"> -->
                    <span class="mui-icon">
                        <img style="width: 40px;" src="../source/webslice/1.0_home/home_qianggou_icon.png" alt="">
                    </span>
                    <span class="mui-tab-label">抢购</span>
                </a>
                <a data-href="indexPage_joinUs.html">
                    <span class="mui-icon">
                        <img style="width: 40px;" src="../source/webslice/1.0_home/home_jiaru_icon.png" alt="">
                    </span>
                    <span class="mui-tab-label">加入</span>
                </a>
                <!-- <a data-href="indexPage_recycleBook.html"> -->
                <a id="recycleBookButton">
                    <span class="mui-icon">
                        <img style="width: 40px;" src="../source/webslice/1.0_home/home_juanshu_icon.png" alt="">
                    </span>
                    <span class="mui-tab-label">捐书</span>
                </a>
                <a data-href="indexPage_bookshelf.html">
                    <span class="mui-icon">
                        <img style="width: 40px;" src="../source/webslice/1.0_home/home_shuku_icon.png" alt="">
                    </span>
                    <span class="mui-tab-label">书库</span>
                </a>
            </nav>
        </div>
        <div style="padding:8px;background:#fff;margin-bottom:10px;">
            <table style="table-layout:fixed;width:100%;">
                <tbody>
                    <tr>
                        <td rowspan="2" style="width:45%;padding:7px;">
                            <a id="recommendItemBox" class="full" data-href="indexPage_textbookList.html">
                                <img class="user-left-placeholder" src="" alt="">
                            </a>
                        </td>
                        <td class="user-right-td" style="border-bottom:1px solid #f2f2f2;">
                            <a id="hotItemBox" class="full" data-href="indexPage_textbookList.html">
                                <img class="user-right-placeholder" src="../source/images/oval-6-copy-4.png" alt="">
                                <div class="user-right-line">
                                    <p style="color:#b1d5ff;">热门教材</p>
                                    <p style="color:#999;">???????</p>
                                </div>
                            </a>
                        </td>
                    </tr>
                    <tr>
                        <td class="user-right-td">
                            <a id="newItemBox" class="full" data-href="indexPage_textbookList.html">
                                <img class="user-right-placeholder" src="../source/images/oval-6-copy-5.png" alt="">
                                <div class="user-right-line">
                                    <p style="color:#ffd693;">最新教材</p>
                                    <p style="color:#999;">???????</p>
                                </div>
                            </a>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <ul id="firstRecommendBlock" class="mui-table-view">
            <li class="mui-table-view-cell">
                <a class="mui-navigate-right">
                    <span class="name"></span><span class="mui-tip">查看更多</span>
                </a>
            </li>
        </ul>
        <ul class="mui-table-view mui-grid-view" style="margin-bottom: 10px;margin-top: -10px;">
            
        </ul>
        <a class="recommendImage" id="firstRecommendImage">
            <img src="" alt="">
        </a>
        <ul id="secondRecommendBlock" class="mui-table-view">
            <li class="mui-table-view-cell">
                <a class="mui-navigate-right">
                    <span class="name"></span><span class="mui-tip">查看更多</span>
                </a>
            </li>
        </ul>
        <ul class="mui-table-view mui-grid-view" style="margin-bottom: 10px;margin-top: -10px;">
            
        </ul>
        <a class="recommendImage" id="secondRecommendImage">
            <img src="" alt="">
        </a>
        <ul id="thirdRecommendBlock" class="mui-table-view">
            <li class="mui-table-view-cell">
                <a class="mui-navigate-right">
                    <span class="name"></span><span class="mui-tip">查看更多</span>
                </a>
            </li>
        </ul>
        <ul class="mui-table-view mui-grid-view" style="margin-bottom: 10px;margin-top: -10px;">
            
        </ul>
        <div style="padding: 13px 0 15px;">
            <img style="width: 150px;margin: 0 auto;display: block;" src="../source/webslice/1.0_home/home_bottom_yunshu.png" alt="">
        </div>
    </div>
<script>
$("#currentCityName").text(currentCityName);
var cityId = currentCityId;
$.when(getBannersByCityId(cityId)).done(function(data){
    if(data.resultCode == 200){
        var data = data.data;
        // 轮播图
        var banners = data.banners;
        var bannersHTML = firstImage = lastImage = "";
        for(var i = 0, length = banners.length; i < length; i++){
            var _banner = banners[i];

            bannersHTML += '<div class="mui-slider-item"><a><img src="'+_banner.path+'"></a></div>';
            if(i == 0){
                firstImage = '<div class="mui-slider-item mui-slider-item-duplicate"><a><img src="'+_banner.path+'"></a></div>';
            }
            if(i == length - 1){
                lastImage = '<div class="mui-slider-item mui-slider-item-duplicate"><a><img src="'+_banner.path+'"></a></div>';
            }
        }
        $("#slider>.mui-slider-group").append(lastImage+bannersHTML+firstImage);
        mui.init();
        mui("#slider").slider({
            interval: 5000
        });


        // 三个小图
        var recommendItem = data.recommendItem;
        $("#recommendItemBox").attr("data-href", recommendItem.url)
            .find(">img").attr("src", recommendItem.path);
        var hotItemBox = data.recommendLists[0];
        $("#hotItemBox").attr("data-href", "indexPage_textbookList.html?"+encodeObj({"hotId":hotItemBox.id,"type":0}));
        var newItemBox = data.recommendLists[1];
        $("#newItemBox").attr("data-href", "indexPage_textbookList.html?"+encodeObj({"newId":hotItemBox.id,"type":0}));
    }
});
$.when(getRecommends(cityId)).done(function(data){
    if(data.resultCode == 200){
        var data = data.data;
        var imgs = data.imgs;
        // 第一张图
        $("#firstRecommendImage").attr("data-href", imgs[0].url).find(">img").attr("src", imgs[0].path);
        // 第二张图
        $("#secondRecommendImage").attr("data-href", imgs[1].url).find(">img").attr("src", imgs[1].path);

        var txts = data.txts;
        // 第一个block
        $("#firstRecommendBlock").find(".name").text(txts[0].name).end()
            .find("a").attr("data-href","indexPage_textbookList.html?"+encodeObj({"recommendId":txts[0].id,"type":1}));
        var firstRecommendBlockHtml = "";
        for(var i = 0, length = txts[0].books.length; i<length; i++){
            var book = txts[0].books[i];
            firstRecommendBlockHtml += createBook(book.id , book.path , book.title);
        }
        $("#firstRecommendBlock").next("ul").append(firstRecommendBlockHtml);
        // 第二个block
        $("#secondRecommendBlock").find(".name").text(txts[1].name).end()
            .find("a").attr("data-href","indexPage_textbookList.html?"+encodeObj({"recommendId":txts[1].id,"type":1}));
        var secondRecommendBlockHtml = "";
        for(var i = 0, length = txts[1].books.length; i<length; i++){
            var book = txts[1].books[i];
            secondRecommendBlockHtml += createBook(book.id , book.path , book.title);
        }
        $("#secondRecommendBlock").next("ul").append(secondRecommendBlockHtml);
        // 第三个block
        $("#thirdRecommendBlock").find(".name").text(txts[2].name).end()
            .find("a").attr("data-href","indexPage_textbookList.html?"+encodeObj({"recommendId":txts[2].id,"type":1}));
        var thirdRecommendBlockHtml = "";
        for(var i = 0, length = txts[2].books.length; i<length; i++){
            var book = txts[2].books[i];
            thirdRecommendBlockHtml += createBook(book.id , book.path , book.title);
        }
        $("#thirdRecommendBlock").next("ul").append(thirdRecommendBlockHtml);
    }
});

$(window).on('touchmove scroll',function(e){
    var pos = $(this).scrollTop()
    if (pos > 100) {
        $('#header').removeClass('top')
    } else {
        $('#header').addClass('top')
    }
});
$("#searchBookInput").on('keydown',function(e){
    if(e.keyCode == 13){
        var value = $(this).val();
        var params = {};
        params.keyword = value;
        window.location.href = "indexPage_searchBook_result.html?"+encodeObj(params);
    }
});
function createBook(id,path,title,colNumber){
    var _colNumber = colNumber?colNumber:"3";
    var params = {};
    params.bookId = id;
    var html = '<li class="mui-table-view-cell mui-media mui-col-sm-'+_colNumber+' mui-col-xs-'+_colNumber+'">'+
                '<a data-href="indexPage_textbook.html?'+encodeObj(params)+'">'+
                    '<div class="textbook_cover">'+
                        '<img class="" src="'+path+'" alt="">'+
                    '</div>'+
                    '<div class="mui-tab-label user-book-label">'+
                        title+
                    '</div>'+
                '</a>'+
            '</li>';
    return html;
}
$("#recycleBookButton").on('tap',function(){
    mui.toast("功能正在开发中");
})
</script>
</body>
</html>














