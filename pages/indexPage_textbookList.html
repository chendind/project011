<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    <title>云书</title>
    <link rel="stylesheet" href="../source/mui/css/mui.css">
    <link rel="stylesheet" href="../source/css/mui_overwrite.css">
    <link rel="stylesheet" href="../source/css/public.css">
    <link rel="stylesheet" href="../source/css/index.css">
    <script src="../source/js/jquery-1.11.1.min.js"></script>
    <script src="../source/mui/js/mui.js"></script>
    <script src="../source/js/ajax.js"></script>
    <script src="../source/js/public.js"></script>
</head>
<body>
	<div class="mui-content">
		<div id="index-bg-header" class="index-bg-header" style="display: none;"></div>
		<div id="bookList">
			
		</div>
	</div>
	<div class="fixedCartButton" style="bottom: 20px;">
        <img src="../source/webslice/0_common/web_common_cart.png" />
    </div>
<script>
mui.init();
var params = getQueryData();
if(!params){
    mui.alert("查询参数错误","",["确定"],function(){
        mui.back();
    });
}
else{
    if(params.subCateId){
        // 某个子类
    	var subCateId = params.subCateId;
    	$.when(getBooksByCategoryId(subCateId, currentCityId, "id", 1)).done(function(data){
    		if(data.resultCode == 200){
    			if(data.data&&data.data.books.length){
    				writeDataToTextbookList(data.data.books);
    			}
    			else{
    				mui.alert("无书本信息","",["确定"],function(){
				        mui.back();
				    });
    			}
    		}
    	});
    }
    else if(params.recommendId||params.hotId||params.newId){
        /* 推荐书籍
           热门书籍
           最新书籍
        */
    	var id = params.recommendId||params.hotId||params.newId,
    	type = params.type;
    	$.when(getRecommendBooksByTypeAndId(type,id)).done(function(data){
    		if(data.resultCode == 200){
    			if(data.data.list&&data.data.list.books.length){
    				writeDataToTextbookList(data.data.list.books, data.data.list.path);
    			}
    			else{
    				mui.alert("无书本信息","",["确定"],function(){
				        mui.back();
				    });
    			}
    		}
    	});
    }
}
$(".smallCartIcon").on('tap',function(e){
	mui.toast("添加成功");
});
function writeDataToTextbookList(books,bannerImagePath){
	if(bannerImagePath){
		$("#index-bg-header").css({
			"background-image": "url("+bannerImagePath+")"
		}).show();
	}
	var html = "";
	for(var i = 0, length = books.length; i<length; i++){
		var book = books[i];
		html += getSingleBookTableCell(book.id, book.path, book.title, book.author, book.publisher, book.marketPrice);
	}
	$("#bookList").append(html);
}
</script>
</body>
</html>










