<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    <title>云书</title>
    <link rel="stylesheet" href="../source/mui/css/mui.css">
    <link rel="stylesheet" href="../source/css/mui_overwrite.css">
    <link rel="stylesheet" href="../source/css/public.css">
    <script src="../source/js/jquery-1.11.1.min.js"></script>
    <script src="../source/js/ajax.js"></script>
    <script src="../source/mui/js/mui.js"></script>
    <script src="../source/js/public.js"></script>
</head>
<body>
    <div class="mui-content mui-fullscreen" style="background-color: #fff;">
        <div class="innerCenter">
            <img style="width: 80px;height: 45px;margin-bottom: 28px;margin-top: 83px;" src="../source/webslice/0_login/login_logo.png" alt="">
            <img style="width: 210px;height: 14px;" src="../source/webslice/0_login/login_slogan.png" alt="">
        
            <form class="mui-input-group ys-input-group" style="margin: 65px 40px 0;">
                <div class="mui-input-row">
                    <input id="phone" type="text" class="mui-input-clear" placeholder="请输入手机号">
                </div>
                <div class="mui-input-row">
                    <input id="verifyCode" type="text" placeholder="请输入验证码">
                    <div id="getcn" class="mui-tip linkColor">获取验证码</div>
                </div>
            </form>
            <div style="margin-top: 60px;">
                <div id="loginButton" class="mui-btn mui-btn-primary mui-btn-long" style="border-radius: 5px;color:#4D99F5">绑定手机号</div>
            </div>
        </div>
    </div>
<script>
mui.init();
function getcn(){
    $("#getcn").one("tap",function() {
        var phone = $("#phone").val();
        var verifyCode = $("#verifyCode").val();
        var that=$(this);
        $.when(getVerifyCode(phone)).done(function(data){
            if(data.resultCode == 200){
                mui.toast("发送成功");
                var count=$('<span class="regetcn greyColor">重新发送'+
                    '&nbsp;(<i style="font-style:normal;">60</i>)'+
                    '</span>');
                that.empty();
                that.append(count);
                function reduceCount(){
                    var num=count.find("i").text();
                    num=num-1;
                    count.find("i").text(num);
                    that.append(count);
                    if(num==0){
                        clearInterval(reduceId);
                        that.text("获取验证码");
                        getcn();
                    }
                }
                var reduceId=window.setInterval(reduceCount,1000);
            }
        });
    });
}
getcn();
$("#verifyCode").on('input',function(){
    if($(this).val().length >= 4){
        $("#loginButton").css({
            "color": "#fff"
        });
    }
    else{
        $("#loginButton").css({
            "color": "#4D99F5"
        });
    }
})
$("#loginButton").on('tap',function(){
    var phone = $("#phone").val();
    var verifyCode = $("#verifyCode").val();
    if(phone.length != 11){
        mui.toast("请输入正确的手机号");
    }
    else if(verifyCode.length != 4){
        mui.toast("请输入正确的验证码");
    }
    else {
        $.when(userLogin(phone,verifyCode)).done(function(data){
            if(data.resultCode == 200){
                window.localStorage.setItem("token",data.data.token);
                window.localStorage.setItem("version",data.data.version);
                window.location.href="indexPage.html";
            }
        });
    }
})
</script>
</body>
</html>














