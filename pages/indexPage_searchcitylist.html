
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title></title>
    <script src="../source/js/jquery-1.11.1.min.js"></script>
    <script src="../source/js/ajax.js"></script>
    <script src="../source/mui/js/mui.js"></script>
    <script src="../source/js/mui.indexedlist.js"></script>

    <link href="../source/mui/css/mui.css" rel="stylesheet" />
    <link href="../source/css/mui.indexedlist.css" rel="stylesheet" />
    <link href="../source/css/searchcity.css" rel="stylesheet" />
    <style>

        /*html,
        body {
            height: 100%;
            overflow: hidden;
        }
        .mui-bar {
            -webkit-box-shadow: none;
            box-shadow: none;
        }
        .user-city-list {
            padding-right: 40px;
            margin-bottom: 12px;
        }
        .user-city-row {
            position: relative;
        }
        .user-city-row:after {
            content: "";
            display: block;
            clear: both;
        }
        .user-city-item {
            float: left;
            font-size: 16px;
            line-height: 1;
            text-align:center;
            padding: 12px 0px;
            width: 30%;
            width: calc((100% - 16px)/3);
            margin-right: 8px;
            margin-bottom: 8px;
            border-radius: 5px;
            background: #f6f6f6;
        }
        .user-city-item.active {
            color: #419bf9;
        }
        .user-city-item:nth-child(3n){
            margin-right: 0px;
        }*/
        
    </style>
</head>

<body>
    <div class="mui-content">
        <div id='list' class="mui-indexed-list">
            <div class="mui-indexed-list-search mui-input-row mui-search" style="border-bottom: none;">
                <input id="searchCityInput" type="search" class="mui-input-clear mui-indexed-list-search-input" placeholder="搜索城市">
            </div>
            <div id="indexed_list_bar" class="mui-indexed-list-bar">
                
            </div>
            <div class="mui-indexed-list-alert"></div>
            <div class="mui-indexed-list-inner">
                <h5>定位城市</h5>
                <div class="user-city-list">
                    <div class="user-city-row">
                        <div class="user-city-item active">杭州市</div>
                    </div>
                </div>
                <h5>热门城市</h5>
                <div class="user-city-list">
                    <div id="user_city_row" class="user-city-row">
                        
                    </div>
                </div>
                <div class="mui-indexed-list-empty-alert">没有数据</div>
                <ul id="normalCityList" class="mui-table-view">
                                        
                </ul>
            </div>
        </div>
    </div>
<script>
    $.when(getAllCity()).done(function(data){
        if(data.resultCode == 200){
            // 字母列表
            var normalCity = data.data.normalCity;
            var hotCity = data.data.hotCities;
            for(var i = 0, length = normalCity.length; i< length; i++){
                var _nc = normalCity[i];
                $('#indexed_list_bar').append('<a>'+_nc.initial+'</a>');
                $("#normalCityList").append(getCharCityBlock(_nc.initial, _nc.cities));
            }
            for(var j = 0, length = hotCity.length; j < length; j++){
                var _hc = hotCity[j];
                console.log(_hc);
                $("#user_city_row").append('<div class="user-city-item" data-id="'+_hc.id+'">'+_hc.name+'</div>')
            }
            mui.init();
            mui.ready(function() {
                var list = document.getElementById('list');
                list.style.height = document.body.offsetHeight + 'px';
                window.indexedList = new mui.IndexedList(list);
            });
        }
    });
function getCharCityBlock(char, cityList){
    var li1 = '<li data-group="'+char+'" class="mui-table-view-divider mui-indexed-list-group">'+char+'</li>';
    var li2 = "";
    for(var c = 0, cl = cityList.length; c < cl; c++){
        var _city = cityList[c];
        li2 += '<li data-id="'+_city.id+'" class="mui-table-view-cell mui-indexed-list-item">'+_city.name+'</li>'
    }
    return li1+li2;
}


$("#searchCityInput").bind('keydown',function(e){
    if(e.keyCode == 13){
        var keyword = $(this).val();
        window.location.href = "indexPage_searchcity_result.html";
        $.when(searchCity(keyword)).done(function(data){
            if(data.resultCode == 200){

            }
        });
    }
})
</script>
</body>
</html>








