<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8"/>
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
		<meta name="viewport" content = "width=device-width, target-densitydpi=high-dpi, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black" />
		<meta content="telephone=no" name="format-detection" />
		<meta name="keywords" content="seokeywords"/>
		<meta name="description" content="seodescription"/>
		<title></title>
		<style>
			body{margin:0px 50px;padding:0px;font-family: "HanHei SC","PingHei","PingFang SC","STHeitiSC-Light","Helvetica Neue","Helvetica","Microsoft Yahei","Arial",sans-serif;}
			.imgbox{width:100%;margin-top:63px;margin-bottom:30px;}
			.imgbox .Combined-Shape{margin:auto;width: 66px;height: 67px;}
			.imgbox .Combined-Shape img{width: 66px;height: 67px;object-fit: contain;}
			.txt{width:100%;}
			.txt .tip{margin: auto;width: 90px;height: 17px;font-size: 17px;font-weight: 400;text-align: center;color: #016df1;}
			
			.input_box{width:100%;margin-top:60px;margin-bottom:60px;}
			.input_box input{font-size: 14px;color: #555;padding: 0.5em 0em;border: 0;width: 100%;border-bottom: 1px solid #e5e5e5;background: none;-webkit-appearance: none;border-radius: 0;}
			
			.btn_box{width:100%;}
			.btn_box .addbtn{margin: auto;width: 214px;height: 46px;border-radius: 5px;background-color: #016df1;border: solid 1px #016df1;font-size: 17px;font-weight: 400;text-align: center;color: #ffffff;line-height:46px;}
			
			
			.black_bg{display:none;position: absolute;z-index:110;background-color: black;width:100%;height:100%;top:0px;left:0px;opacity: 0.6;}
			
			.net_error_bg{display:none;margin-top: -150px;}
			.network_error{margin:auto;z-index:111;width: 176px;height: 50px;opacity: 0.6;border-radius: 8px;-webkit-backdrop-filter: blur(15px);backdrop-filter: blur(15px);background-color: #000000;}
			.net_error_bg .network_error_txt{position: relative;top: -35px;text-align: center;color: white;z-index: 112;font-size: 16px;font-weight: 400;line-height: 1;color: #ffffff;    width: 176px;margin: auto;}
		</style>
		<script type="text/javascript" src="js/jquery-2.1.4.min.js" ></script>
		<script type="text/javascript" src="js/common.js" ></script>
		<script type="text/javascript" src="js/encoding-indexes.js" ></script>
		<script type="text/javascript" src="js/encoding.js" ></script>
		<script>
			window.onload=function(){
				$(".btn_box").on({
					"click":function(){
						AddConpon();
					}
				},".addbtn");
				var content = document.querySelector(".black_bg");
				content.addEventListener("touchend", function(){
				     $(".black_bg").hide();
						$(".net_error_bg").hide();
				});
			}
			function AddConpon()
			{
				var data='{"code":"'+$("#code").val()+'"}';
				var uint8array = new TextEncoder().encode(data);
				//var uint8array = new TextEncoder('utf-8', { NONSTANDARD_allowLegacyEncoding: true }).encode($("#code").val());
				//alert(uint8array);
				$.ajax({
					type:"POST",
					url:"http://120.26.94.240:8989/users/coupons/exchange",
					async:true,
					contentType:'application/octet-stream',
					data:uint8array,
					processData:false,
					beforeSend: function(request) {
                        request.setRequestHeader("token",getQueryStr("token"));
                        request.setRequestHeader("OriginType","h5");
                    },
					success:function(data){
						if(data.resultCode==200)
						{
							$(".btn_box").off('click',".addbtn");
							$(".black_bg").css("top",document.body.scrollTop);
							$(".black_bg").show();
							$(".net_error_bg").show();
							$(".network_error_txt").html("添加成功");
							$("#code").val("");
							setTimeout(function(){
								window.location.href="usedCouponList.html?token="+getQueryStr("token");
							},2000);
						}
						else
						{
							$(".black_bg").css("top",document.body.scrollTop);
							$(".black_bg").show();
							$(".net_error_bg").show();
							$(".network_error_txt").html(data.message);
						}
					},
					error:function()
					{
						$(".black_bg").css("top",document.body.scrollTop);
						$(".black_bg").show();
						$(".net_error_bg").show();
						$(".network_error_txt").html(data.message);
					}
				});
			}
		</script>
	</head>
	<body>
		<div class="imgbox"><div class="Combined-Shape"><img src="img/coupon_add_icon.png"></div></div>
		<div class="txt"><div class="tip">添加优惠券</div></div>
		<div class="input_box"><input id="code" type="text" placeholder="请输入兑换码"></div>
		<div class="btn_box"><div class="addbtn">添加</div></div>
		
		<div class="black_bg"></div>
		<div class="net_error_bg">
			<div class="network_error"></div>
			<div class="network_error_txt"></div>
		</div>
	</body>
</html>
